<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="Board">
 	<insert id="boardInsert">
 		INSERT INTO BOARD(BNUMBER, MID, BDATE, BTITLE, BCONTENT, BIMG, BCNUMBER)
 		VALUES(BNUMBER_SEQ.NEXTVAL, #{MID}, SYSDATE, #{BTITLE}, #{BCONTENT}, #{BIMG}, #{BCNUMBER})
 	</insert>
 	
 	<select id="boardList" parameterType="BoardCategory" resultType="BoardList">
 		SELECT BOARD.BNUMBER,
    			BOARD.BTITLE,
    			BOARD.BDATE,
    			BOARD.BIMG,
    			BOARDCATEGORY.BCNAME,
    			MEMBER.MNICK,
    			BV.BOARDVIEWS,
    			BL.BOARDLIKE,
    			BC.BOARDCOMPLAINT
		FROM BOARD INNER JOIN MEMBER ON BOARD.MID = MEMBER.MID
            		INNER JOIN BOARDCATEGORY ON BOARD.BCNUMBER = BOARDCATEGORY.BCNUMBER
           			LEFT OUTER JOIN (SELECT BNUMBER,
                                			COUNT(MID) AS "BOARDVIEWS"
                        			FROM BOARDVIEWS
                        			GROUP BY BNUMBER) BV ON BOARD.BNUMBER = BV.BNUMBER
            		LEFT OUTER JOIN (SELECT BNUMBER,
                                    		COUNT(MID) AS "BOARDLIKE"
                            		FROM BOARDLIKE
                            		GROUP BY BNUMBER) BL ON BOARD.BNUMBER = BL.BNUMBER
            		LEFT OUTER JOIN (SELECT BNUMBER,
                                    		COUNT(MID) AS "BOARDCOMPLAINT"
                            		FROM BOARDCOMPLAINT
                            		GROUP BY BNUMBER) BC ON BOARD.BNUMBER = BC.BNUMBER
 		<include refid="boardCategory"></include>
 		ORDER BY BNUMBER DESC
 	</select>
 	
 	<sql id="boardCategory">
 		<choose>
 			<when test="BCNUMBER != 0">
 				WHERE BOARD.BCNUMBER = #{BCNUMBER}
 			</when>
 		</choose>
 	</sql>
 	
 	<select id="boardCategory" parameterType="BoardCategory" resultType="BoardCategory">
 		SELECT *
 		FROM BOARDCATEGORY
 		WHERE BCNUMBER = #{BCNUMBER}
 	</select>
 </mapper>